<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ambition.agile.modules.org.dao.OrgBakDao">
    
	<sql id="orgColumns">
		
		a.id AS "id",
		a.sn AS "sn",
		a.bak_type AS "bakType",
		a.org_id as "orgId",
		a.name AS "name",
		a.sc_code AS "scCode",
		a.reg_money AS "regMoney",
		a.reg_address AS "regAddress",
		a.buslice_path AS "buslicePath",
		a.email AS "email",
		a.total_asset AS "totalAsset",
		a.net_asset AS "netAsset",
		a.logo_path AS "logoPath",
		a.status AS "status",
		a.area_id AS "area.id",
		a.nature AS "nature",
		a.create_date AS "createDate",
		a.create_id AS "createId",
		a.type AS "type",
		a.area_parentids AS areaParentids,
		a.description AS "description",
		a.legalrep_name AS "legalrepName",
		a.legalrep_card AS "legalrepCard",
		a.legalrep_phone AS "legalrepPhone",
		a.legalrep_address AS "legalrepAddress",
		a.legalrep_zipcode AS "legalrepZipcode",
		a.legalrep_photo AS "legalrepPhoto",
		a.socialinsu_photo AS "socialinsuPhoto",
		a.recent_money AS "recentMoney",
		a.submit_time AS "submitTime",
		a.audit_time AS "auditTime",
		a.final_time AS "finalTime",
		a.bak_time as "bakTime",
		a12.name AS "area.name"
	</sql>
	
	<sql id="orgJoins">
		LEFT JOIN sys_area a12 ON a12.id = a.area_id
	</sql>
    
	<select id="get" resultType="OrgBak">
		SELECT 
			<include refid="orgColumns"/>
		FROM org_bak a
		<include refid="orgJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<!-- 1 -->
	<insert id="bakOrg"  useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		INSERT INTO org_bak(
			sn,
			org_id,
			bak_type,
			name,
			sc_code,
			reg_money,
			reg_address,
			buslice_path,
			email,
			total_asset,
			net_asset,
			logo_path,
			status,
			area_id,
			area_parentids,
			nature,
			create_date,
			create_id,
			type,
			description,
			legalrep_name,
			legalrep_card,
			legalrep_phone,
			legalrep_address,
			legalrep_zipcode,
			legalrep_photo,
			socialinsu_photo,
			bak_time
		) VALUES (
			#{sn},
			#{org.id},
			#{type},
			#{org.name},
			#{org.scCode},
			#{org.regMoney},
			#{org.regAddress},
			#{org.buslicePath},
			#{org.email},
			#{org.totalAsset},
			#{org.netAsset},
			#{org.logoPath},
			#{org.status},
			#{org.area.id},
			#{org.areaParentids},
			#{org.nature},
			#{org.createDate},
			#{org.createId},
			#{org.type},
			#{org.description},
			#{org.legalrepName},
			#{org.legalrepCard},
			#{org.legalrepPhone},
			#{org.legalrepAddress},
			#{org.legalrepZipcode},
			#{org.legalrepPhoto},
			#{org.socialinsuPhoto},
			#{bakTime}
		)
	</insert>
	<!-- 2 -->
	<insert id="bakOrgAchieve"  useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		INSERT INTO org_achieve_bak(
			sn,
			num,
			name,
			type,
			entrust_unit,
			entrust_money,
			bid_money,
			tender_open_time,
			bid_time,
			notice_media,
			notice_date,
			remark,
			org_id
		) VALUES (
			#{sn},
			#{orgAchieve.num},
			#{orgAchieve.name},
			#{orgAchieve.type},
			#{orgAchieve.entrustUnit},
			#{orgAchieve.entrustMoney},
			#{orgAchieve.bidMoney},
			#{orgAchieve.tenderOpenTime},
			#{orgAchieve.bidTime},
			#{orgAchieve.noticeMedia},
			#{orgAchieve.noticeDate},
			#{orgAchieve.remark},
			#{orgAchieve.orgId}
		)
	</insert>
	<!-- 3 -->
	<insert id="bakOrgStaff"  useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		INSERT INTO org_staff_bak(
			sn,
			org_id,
			name,
			sex,
			card,
			card_photo,
			work_start,
			university,
			degree,
			ssn,
			protitle_photo,
			pro_title,
			voc_qua,
			work_type,
			dept
		) VALUES (
			#{sn},
			#{orgStaff.orgId},
			#{orgStaff.name},
			#{orgStaff.sex},
			#{orgStaff.card},
			#{orgStaff.cardPhoto},
			#{orgStaff.workStart},
			#{orgStaff.university},
			#{orgStaff.degree},
			#{orgStaff.ssn},
			#{orgStaff.protitlePhoto},
			#{orgStaff.proTitle},
			#{orgStaff.vocQua},
			#{orgStaff.workType},
			#{orgStaff.dept}
		)
	</insert>
	
	<!-- 4 -->
	<insert id="bakOrgQualification"  useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		INSERT INTO org_qualification_bak(
			sn,
			name,
			grade,
			path,
			org_id,
			create_time,
			create_id
		) VALUES (
			#{sn},
			#{orgQualification.name},
			#{orgQualification.grade},
			#{orgQualification.path},
			#{orgQualification.orgId},
			#{orgQualification.createTime},
			#{orgQualification.createId}
		)
	</insert>
	
	<select id="findList" resultType="OrgBak">
		SELECT 
			<include refid="orgColumns"/>
		FROM org_bak a
		<include refid="orgJoins"/>
		<where>
			org_id = #{orgId}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	<select id="getBakQualificationBySnAndOrgId" parameterType="java.util.Map" resultType="java.util.Map">
		select sn,
			name,
			grade,
			path,
			org_id,
			create_time,
			create_id from org_qualification_bak where org_id = #{orgId} and sn = #{sn}
	</select>
	<select id="getBakStaffBySnAndOrgId" parameterType="java.util.Map" resultType="java.util.Map">
		select sn,
			org_id,
			name,
			sex,
			card,
			card_photo,
			work_start,
			university,
			degree,
			ssn,
			protitle_photo,
			pro_title,
			voc_qua,
			work_type,
			dept from org_staff_bak where org_id = #{orgId} and sn = #{sn}
	</select>
	<select id="getBakAhieveBySnAndOrgId" parameterType="java.util.Map" resultType="java.util.Map">
		select sn,
			num,
			name,
			type,
			entrust_unit,
			entrust_money,
			bid_money,
			tender_open_time,
			bid_time,
			notice_media,
			notice_date,
			remark,
			org_id from org_achieve_bak where org_id = #{orgId} and sn = #{sn}
	</select>
	
	
</mapper>