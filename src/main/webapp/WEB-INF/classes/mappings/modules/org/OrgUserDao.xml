<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ambition.agile.modules.org.dao.OrgUserDao">
    
	<sql id="orgUserColumns">
		a.id AS "id",
		a.login_name AS "loginName",
		a.user_name AS "userName",
		a.password AS "password",
		a.email AS "email",
		a.org_id AS "org.id",
		a.telphone AS "telphone",
		a.status AS "status",
		a.sex AS "sex",
		a.birthday AS "birthday",
		a.degree AS "degree",
		a.photo_path AS "photoPath",
		a.create_time AS "createTime",
    	c.name AS "org.name"
	</sql>
	
	<sql id="orgUserJoins">
	
		LEFT JOIN org c ON c.id = a.org_id
	
	</sql>
    
	<select id="get" resultType="OrgUser">
		SELECT 
			<include refid="orgUserColumns"/>
		FROM org_user a
		<include refid="orgUserJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="OrgUser">
		SELECT 
			<include refid="orgUserColumns"/>
		FROM org_user a
		<include refid="orgUserJoins"/>
		<where>
			
			<if test="loginName != null and loginName != ''">
				AND a.login_name LIKE 
					<if test="dbName == 'oracle'">'%'||#{loginName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{loginName}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{loginName},'%')</if>
			</if>
			<if test="userName != null and userName != ''">
				AND a.user_name LIKE 
					<if test="dbName == 'oracle'">'%'||#{userName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{userName}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{userName},'%')</if>
			</if>
			<if test="status != null and status != ''">
				AND a.status = #{status}
			</if>
			<if test="org != null  and org.area != null and org.area.id != ''">
				AND c.area_id = #{org.area.id}
			</if>
			<if test="org != null  and org.name != null and org.name != ''">
				AND c.name like concat('%',#{org.name},'%')
			</if>
			<!--
			<if test="org.area != null and org.area.id != null">
				AND c.area_id = #{org.area.id}
			</if>
			-->
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="OrgUser">
		SELECT 
			<include refid="orgUserColumns"/>
		FROM org_user a
		<include refid="orgUserJoins"/>
		<where>
			
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO org_user(
			login_name,
			user_name,
			password,
			email,
			 
			telphone,
			status,
			sex,
			birthday,
			degree,
			photo_path,
			create_time
		) VALUES (
			#{loginName},
			#{userName},
			#{password},
			#{email},
			 
			#{telphone},
			#{status},
			#{sex},
			#{birthday},
			#{degree},
			#{photoPath},
			#{createTime}
		)
	</insert>
	
	<update id="update">
		UPDATE org_user SET 	
			login_name = #{loginName},
			user_name = #{userName},
			 password=  #{password},
			email = #{email},
			telphone = #{telphone},
			status = #{status},
			sex = #{sex},
			org_id = #{org.id},
			birthday = #{birthday},
			degree = #{degree}
		WHERE id = #{id}
	</update>
	<!--  			password = #{password}, ,,			org_id = #{org.id},
			photo_path = #{photoPath}
			create_time = #{createTime} -->
	<update id="delete">
		DELETE FROM org_user
		WHERE id = #{id}
	</update>
	
	<!-- 查询用户是否重复 -->
	<select id="findLoginName" parameterType="java.lang.String" resultType="Integer">
		SELECT count(login_name) FROM  org_user a WHERE a.login_name = #{loginName}
	</select>
	 
	
	 
	<select id="findInfoByName" parameterType="java.lang.String" resultType="OrgUser">
		SELECT a.id,
		a.login_name,
		a.user_name,
		a.password,
		a.email,
		a.org_id,
		a.telphone,
		a.status,
		a.sex,
		a.birthday,
		a.degree,
		a.photo_path,
		a.create_time  FROM  org_user a WHERE a.login_name = #{loginName}
	</select>
	
	<!-- 根据id查询邮箱 -->
	<select id="findEmailById" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT email FROM  org_user WHERE org_id in (#{id}) 
	</select>
</mapper>